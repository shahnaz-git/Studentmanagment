pipeline{
    agent any
   
     
    parameters{
        string(name: 'DOCKER_REPO', defaultValue: 'nxg-digital')
        string(name: 'DOCKER_IMAGE', defaultValue: 'studentmanagement')
        string(name: 'DOCKER_TAG', defaultValue: 'v1')
        // string(name: '', defaultValue: 'nxg-digital')
    }
    environment{
        BRANCH_NAME = "${GIT_BRANCH.split("/")[1]}"
    }
    stages{
        stage('SCM Checkout'){
            steps{
                 sh 'which git'
                 git 'https://github.com/shahnaz-git/Studentmanagment.git'

                 // echo 'pulling branch '+ ${env.BRANCH_NAME}
                 // git branch: "${env.BRANCH_NAME}" , credentialsId: 'github', url: 'https://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@github.com/shahnaz-git/Studentmanagment.git'
                 
                
           
                  
                 }
            }
        stage('Build Maven'){
            steps{
                
                // sh "mvn -Dmaven.test.failure.ignore=true clean package"
                 
                sh "mvn clean install"
            }
        }
         
        stage('Build Image'){
            steps{
                script{
                     
                    sh 'docker build -t gcr.io/${params.DOCKER_REPO}/${params.DOCKER_IMAGE}:${params.DOCKER_TAG}  .'
                    
                }
            }
        }
        stage('Push Image'){
            steps{
                script{
                     
                    sh 'gcloud auth configure-docker'
                    sh 'sudo docker push gcr.io/${params.DOCKER_REPO}/${params.DOCKER_IMAGE}:${params.DOCKER_TAG} '
                    
                }
            }
        }
        stage('Remove Image'){
            steps{
                script{
                    echo "Remove docker image"
                    sh 'sudo docker rmi gcr.io/${params.DOCKER_REPO}/${params.DOCKER_IMAGE}:${params.DOCKER_TAG} '
                    
                }
            }
        }
    //     post{
    //         always{
    //           emailext to: "sowjanya@nxgsolutions.in",
    //           subject: "Test Email",
    //           body: "Test",
    //           attachLog: true
    //     }
    // }
        
    }
}
